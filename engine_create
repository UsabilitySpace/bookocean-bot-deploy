
# creates usability space bot engine

# (still under development)

# prepare includes

  SCRIPT_DIR="$( cd -- "$( dirname -- "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )"
  source $SCRIPT_DIR/engine_redeploy_scripts

# prepare vars

  ROOT_DIR="/var/www/www-root/data/nodejs/server"
  BASE_DIR="usability-space-bot-engine"

  PASSWORD="a9A387aagf?Q_"

# prepare functions

  # generates OpenSSH key 31 host
  function generate_key(){
    echo "Enter:"
    echo   "● File in which to save the key : $1"
    echo   "● Passphrase (EXACTELY THE SAME): $PASSWORD"
    ssh-keygen -t ed25519 -C "kobuch@ya.ru"
  }
# remempber curdir

  curdir="$PWD"

# go to root working dir

  go "$ROOT_DIR"

# make base engine dir

  nd "$BASE_DIR"

# create .ssh/git-deploy-key
# and fill it with keys

  nd ".ssh"
  nd "git-deploy-key"

  # user need to enter 4 pairs of data
  # which are hinted by generate_key:

    generate_key github.com-repo-bookocean-engine-bot
    generate_key github.com-repo-bookocean-engine-config
    generate_key github.com-repo-bookocean-engine-deploy
    generate_key github.com-repo-bookocean-engine-menu

  # prepare to ssh-add —
  # launch ssh-agent in background

    eval "$(ssh-agent -s)"

  # create ssh-keys

    # ask user

      type="0"

      while [ "$type" -ne "1" && "$type" -ne "2" ] ; do

        echo "Chose how you want to create ssh keys on this hosting:"
        echo "  ● 1 — create new keys (you will need to publish them to the git, which will need access to git and may take a long time;"
        echo "  ● 2 — copy existing keys from developer's hosting (you won't need to publish them to the git, so you won't need access to git, but you need to know developer's IP ans SSH login/password."
        echo "Which is your choice — 1 or 2 ?"

        read type

      done

    # create keys

      if [ "$type" -eq "1" ] ; then

        # ssh-add 1 st time

        ssh-add /var/www/www-root/data/nodejs/server/usability-space-bot-engine/.ssh/git-deploy-key/github.com-repo-bookocean-engine-bot
        ssh-add /var/www/www-root/data/nodejs/server/usability-space-bot-engine/.ssh/git-deploy-key/github.com-repo-bookocean-engine-config
        ssh-add /var/www/www-root/data/nodejs/server/usability-space-bot-engine/.ssh/git-deploy-key/github.com-repo-bookocean-engine-deploy
        ssh-add /var/www/www-root/data/nodejs/server/usability-space-bot-engine/.ssh/git-deploy-key/github.com-repo-bookocean-engine-menu

      else

        # copy from developers hosting

        scp -r root@192.168.0.104:/var/www/www-root/data/nodejs/server/usability-space-bot-engine/.ssh/git-deploy-key /var/www/www-root/data/nodejs/server/usability-space-bot-engine/.ssh

      fi

  # create proper ~/.ssh/config

    # save backup for safety
    cp ~/.ssh/config  ~/.ssh/config-$(date +"%Y-%d-%m-%H-%M-%S")

    # append new content to the end of ~/.ssh/config
    cat ./~_ssh_config ~/.ssh/config > ~/.ssh/config

  # return from .ssh/git-deploy-key

    ...

# clone git

  # create folders (just for joke)

    md bot
    md config
    md deploy
    md menu

  # clone projects

    git clone --single-branch --branch master https://UsabilitySpace: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@github.com/UsabilitySpace/bookocean-engine-bot.git     bot
    git clone --single-branch --branch master https://UsabilitySpace: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@github.com/UsabilitySpace/bookocean-engine-config.git  config
    git clone --single-branch --branch master https://UsabilitySpace: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@github.com/UsabilitySpace/bookocean-engine-deploy.git  deploy
    git clone --single-branch --branch master https://UsabilitySpace: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@github.com/UsabilitySpace/bookocean-engine-menu.git    menu

# report user

  echo "Creation of a new bot engine has finished."
  echo "See for absense of errors above to check if the creation process has been successful."

# return to cur dir

  # cd curdir # of no need

# must do nothing else ■
